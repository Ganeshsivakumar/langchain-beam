<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-templates/llm-batch-process" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.6.3">
<title data-rh="true">LLM batch processor | langchain-beam</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://github.com/langchain-beam/img/logo.png"><meta data-rh="true" name="twitter:image" content="https://github.com/langchain-beam/img/logo.png"><meta data-rh="true" property="og:url" content="https://github.com/langchain-beam/docs/templates/llm-batch-process/"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="keywords" content="apache beam, langchain, langchain-beam, PTransform"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="LLM batch processor | langchain-beam"><meta data-rh="true" name="description" content="Llm Batch Processor is a pre-built Apache Beam pipeline that lets you process a batch of text inputs using an LLM (OpenAI models) and save the results to a GCS path. You provide an instruction prompt that tells the model how to process the input data—basically, what to do with it. The pipeline uses the model to transform the data and writes the final output to a GCS file."><meta data-rh="true" property="og:description" content="Llm Batch Processor is a pre-built Apache Beam pipeline that lets you process a batch of text inputs using an LLM (OpenAI models) and save the results to a GCS path. You provide an instruction prompt that tells the model how to process the input data—basically, what to do with it. The pipeline uses the model to transform the data and writes the final output to a GCS file."><link data-rh="true" rel="icon" href="/langchain-beam/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://github.com/langchain-beam/docs/templates/llm-batch-process/"><link data-rh="true" rel="alternate" href="https://github.com/langchain-beam/docs/templates/llm-batch-process/" hreflang="en"><link data-rh="true" rel="alternate" href="https://github.com/langchain-beam/docs/templates/llm-batch-process/" hreflang="x-default"><link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-LJN8GV9JEH"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-LJN8GV9JEH",{anonymize_ip:!0})</script><link rel="stylesheet" href="/langchain-beam/assets/css/styles.1eaac90d.css">
<script src="/langchain-beam/assets/js/runtime~main.40724c01.js" defer="defer"></script>
<script src="/langchain-beam/assets/js/main.f545adfd.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/langchain-beam/"><div class="navbar__logo"><img src="/langchain-beam/img/logo.png" alt="langchain-beam logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/langchain-beam/img/logo.png" alt="langchain-beam logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Langchain-Beam</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/langchain-beam/docs/intro/">Docs</a></div><div class="navbar__items navbar__items--right"><a href="https://javadoc.io/doc/io.github.ganeshsivakumar/langchain-beam/latest/index.html" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Javadoc<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://github.com/Ganeshsivakumar/langchain-beam/tree/main/example/langchain-beam-example/src/main/java/com/langchainbeam/example" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Examples<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://github.com/Ganeshsivakumar/langchain-beam" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/langchain-beam/docs/intro/">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/langchain-beam/docs/category/how-to-guides/">How-To guides</a><button aria-label="Expand sidebar category &#x27;How-To guides&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/langchain-beam/docs/category/tutorials/">Tutorials</a><button aria-label="Expand sidebar category &#x27;Tutorials&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/langchain-beam/docs/category/conceptual-guide/">Conceptual guide</a><button aria-label="Expand sidebar category &#x27;Conceptual guide&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/langchain-beam/docs/category/templates/">Templates</a><button aria-label="Collapse sidebar category &#x27;Templates&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/langchain-beam/docs/templates/llm-batch-process/">LLM batch processor</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/langchain-beam/docs/category/integrations/">Integrations</a><button aria-label="Expand sidebar category &#x27;Integrations&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/langchain-beam/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/langchain-beam/docs/category/templates/"><span itemprop="name">Templates</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">LLM batch processor</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>LLM batch processor</h1></header>
<p>Llm Batch Processor is a pre-built Apache Beam pipeline that lets you process a batch of text inputs using an LLM (OpenAI models) and save the results to a GCS path. You provide an instruction prompt that tells the model how to process the input data—basically, what to do with it. The pipeline uses the model to transform the data and writes the final output to a GCS file.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="what-it-does-️">What It Does 🛠️<a href="#what-it-does-️" class="hash-link" aria-label="Direct link to What It Does 🛠️" title="Direct link to What It Does 🛠️">​</a></h2>
<p>This template:</p>
<ul>
<li>Reads input text data from a file (e.g., in Google Cloud Storage).</li>
<li>Applies an LLM transformation via prompt using the <a href="https://github.com/Ganeshsivakumar/langchain-beam" target="_blank" rel="noopener noreferrer">LangchainBeam</a> library.</li>
<li>Writes the formatted output to a specified location in <code>.txt</code> format.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="use-cases-">Use Cases 📦<a href="#use-cases-" class="hash-link" aria-label="Direct link to Use Cases 📦" title="Direct link to Use Cases 📦">​</a></h2>
<ul>
<li>Information extraction</li>
<li>Text summarization</li>
<li>Classification</li>
<li>Structured Output for Downstream Use</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="template-parameters-️">Template Parameters ⚙️<a href="#template-parameters-️" class="hash-link" aria-label="Direct link to Template Parameters ⚙️" title="Direct link to Template Parameters ⚙️">​</a></h2>
<table><thead><tr><th>Parameter</th><th>Description</th></tr></thead><tbody><tr><td><code>inputDataFile</code></td><td>Path to the input text file (e.g., <code>gs://your-bucket/input.txt</code>)</td></tr><tr><td><code>llmOutputFile</code></td><td>Output file prefix (e.g., <code>gs://your-bucket/output/llm-results</code>)</td></tr><tr><td><code>modelName</code></td><td>Name of the LLM model to use (e.g., <code>gpt-3.5-turbo</code>, <code>gpt-4o-mini</code>)</td></tr><tr><td><code>apiKey</code></td><td>Your OpenAI API key (e.g., <code>sk-proj-BX_6MwMEV5_wont_share_my_key_tho</code>)</td></tr><tr><td><code>prompt</code></td><td>Instruction prompt that guides the model on how to process the input data</td></tr></tbody></table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="how-to-run-">How to Run 🚀<a href="#how-to-run-" class="hash-link" aria-label="Direct link to How to Run 🚀" title="Direct link to How to Run 🚀">​</a></h2>
<p>You can deploy this template using the Beam runner of your choice.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-google-cloud-dataflow">1. Google Cloud Dataflow<a href="#1-google-cloud-dataflow" class="hash-link" aria-label="Direct link to 1. Google Cloud Dataflow" title="Direct link to 1. Google Cloud Dataflow">​</a></h3>
<p>This pipeline is built and packaged as a <a href="https://cloud.google.com/dataflow/docs/guides/templates/using-flex-templates" target="_blank" rel="noopener noreferrer">Dataflow Flex Template</a>, and the template file (<code>gs://langbeam-cloud/templates/llm-batch-process.json</code>) is publicly accessible. This means you can run it directly in your own GCP project by using the <code>gcloud</code> CLI with appropriate parameters.</p>
<p>The pipeline source code is fully <a href="https://github.com/Ganeshsivakumar/langchain-beam" target="_blank" rel="noopener noreferrer">open source on GitHub</a>. You&#x27;re free to fork the repository, customize the pipeline, rebuild it as a Flex Template, and deploy it using your own GCP infrastructure.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="run-template">Run Template:<a href="#run-template" class="hash-link" aria-label="Direct link to Run Template:" title="Direct link to Run Template:">​</a></h4>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">gcloud dataflow flex-template run &quot;llm-batch-process&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --template-file-gcs-location=&quot;gs://langbeam-cloud/templates/llm-batch-process.json&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --region=&quot;us-east1&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --project=&quot;ptransformers&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --network=&quot;default&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --subnetwork=&quot;https://www.googleapis.com/compute/v1/projects/project-id/regions/us-east1/subnetworks/default&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --staging-location=&quot;gs://your-stage-bucket/stage/&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --temp-location=&quot;gs://your-stage-bucket/temp/&quot; \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --parameters=&quot;inputDataFile=gs://pt-public-bucket/inputfile/product_reviews.csv,llmOutputFile=gs://your-bucket/outputfile/output,modelName=gpt-4o-mini,apiKey=openaikey,prompt=Categorize the product review as Positive or Negative&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>If you&#x27;d like to host the template in your own GCP project:</p>
<ul>
<li>
<p><strong>Fork the Langchain-Beam repo</strong> and clone it locally.<br>
<!-- -->You’ll find the <code>llm-batch-process</code> template under the <code>templates/</code> directory.</p>
</li>
<li>
<p><strong>Build the template</strong> using Maven:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mvn clean package -Prunner-dataflow</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
</li>
<li>
<p><strong>Use the <code>gcloud</code> CLI</strong> to run Dataflow Flex Template Build command.<br>
<!-- -->This will:</p>
<ul>
<li>Push your pipeline JAR as a container image to Artifact Registry</li>
<li>Generate a <code>template.json</code> file in your GCS bucket, which acts as a pointer to your pipeline image and contains configuration metadata</li>
</ul>
</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="build-command">Build Command:<a href="#build-command" class="hash-link" aria-label="Direct link to Build Command:" title="Direct link to Build Command:">​</a></h4>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">gcloud dataflow flex-template build gs://langbeam-cloud/templates/llm-batch-process.json \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --image-gcr-path=us-docker.pkg.dev/your-projectid/your-repo/llm-batch-process:latest \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --jar=/your-folder-path/langchain-beam/lbtemplate/langchain-beam/templates/llm-batch-process/target/llm-batch-process-dataflow.jar \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --env=FLEX_TEMPLATE_JAVA_MAIN_CLASS=com.templates.langchainbeam.LlmBatchTextProcessor \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --flex-template-base-image=JAVA17 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --metadata-file=/your-folder-path/langchain-beam/templates/llm-batch-process/src/main/metadata/metadata.json \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --sdk-language=JAVA</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Now the template is buit and hosted your GCS path. you can pass GCS template file to run command to execute the template on dataflow</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-apache-flink">2. Apache Flink<a href="#2-apache-flink" class="hash-link" aria-label="Direct link to 2. Apache Flink" title="Direct link to 2. Apache Flink">​</a></h3>
<p>If you have an Apache Flink standalone cluster, you can submit the template as a job using the prebuilt Docker image.</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">docker run --rm \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -e FLINK_MASTER=host.docker.internal:8081 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  -e FLINK_VERSION=1.18 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  us-docker.pkg.dev/ptransformers/langbeam-cloud/templates/flink/llm-batch-process:latest \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --runner=FlinkRunner \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --inputDataFile=gs://pt-public-bucket/inputfile/product_reviews.csv \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --llmOutputFile=gs://your-bucket/outputfile/output \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --modelName=gpt-4o \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --apiKey=your_openai_key \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --prompt=&quot;Categorize the product review as Positive or Negative&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="how-it-works">How It Works<a href="#how-it-works" class="hash-link" aria-label="Direct link to How It Works" title="Direct link to How It Works">​</a></h4>
<p>The pipeline is built and packaged as a JAR. Since Apache Beam’s Flink Runner must be compatible with your Flink version, there are multiple JARs available—each tailored to a specific Beam and Flink version combination.
Refer to the Flink version <a href="https://beam.apache.org/documentation/runners/flink/#flink-version-compatibility" target="_blank" rel="noopener noreferrer">compatibility matrix</a> to choose the correct version.</p>
<ul>
<li>
<p>The container downloads the appropriate .jar file from GCS based on <em><strong>FLINK_VERSION</strong></em> (your flink cluster version) with right beam and runner depedencies</p>
</li>
<li>
<p>It uses the Flink CLI (flink run) to submit the job to the Flink cluster (as specified by <code>FLINK_MASTER</code>)</p>
</li>
<li>
<p>All dependencies—including Java 17 and the Flink CLI—are preinstalled in the image, so you don’t need to set up anything else.</p>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-locally">3. Locally<a href="#3-locally" class="hash-link" aria-label="Direct link to 3. Locally" title="Direct link to 3. Locally">​</a></h3>
<p>You can also run the template locally using the Apache Beam DirectRunner. This is useful for testing, debugging, or running small jobs without setting up a full cluster.</p>
<p>Prerequisites:</p>
<ul>
<li>JDK 17</li>
<li>Maven</li>
</ul>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="run-with-maven">Run with Maven<a href="#run-with-maven" class="hash-link" aria-label="Direct link to Run with Maven" title="Direct link to Run with Maven">​</a></h4>
<p>Clone the repository:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">git clone https://github.com/Ganeshsivakumar/langchain-beam.git</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cd langchain-beam/templates/llm-batch-process</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Build the template:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mvn clean package -Prunner-direct</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Run with direct runner:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">java -cp target/llm-batch-process-direct.jar \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  com.templates.langchainbeam.LlmBatchTextProcessor \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --runner=DirectRunner \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --inputDataFile=gs://pt-public-bucket/inputfile/product_reviews.csv \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --llmOutputFile=/tmp/output \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --modelName=gpt-4o \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --apiKey=your_openai_key \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --prompt=&quot;Categorize the product review as Positive or Negative&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>You can use a local file (e.g., --inputDataFile=/path/to/input.txt) instead of GCS during local runs.</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="4-apache-spark">4. Apache Spark<a href="#4-apache-spark" class="hash-link" aria-label="Direct link to 4. Apache Spark" title="Direct link to 4. Apache Spark">​</a></h3>
<p>Spark support will be added soon via <a href="https://beam.apache.org/documentation/runners/spark/" target="_blank" rel="noopener noreferrer">Beam&#x27;s Spark runner</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="template-support-">Template Support 🧰<a href="#template-support-" class="hash-link" aria-label="Direct link to Template Support 🧰" title="Direct link to Template Support 🧰">​</a></h2>
<p>This template is fully open source and part of the <a href="https://github.com/Ganeshsivakumar/langchain-beam" target="_blank" rel="noopener noreferrer">Langchain-Beam</a> project.</p>
<p>We built it to make it easier for developers and data teams to bring the power of LLMs into their data pipelines — whether you&#x27;re using Flink, Dataflow, or running jobs locally.</p>
<p>Feel free to:</p>
<ul>
<li>
<p>🔧 Fork and customize the template to suit your specific use case and Deploy it using your own infrastructure or extend it to support new LLMs or output formats.</p>
</li>
<li>
<p>🌱 Submit a PR if you&#x27;d like to contribute improvements, new features, or even entirely new templates.</p>
</li>
<li>
<p>🐞 Create an issue if you run into any problems running the template on Flink, Dataflow, or locally — we&#x27;re happy to help troubleshoot!</p>
</li>
</ul>
<p>✨ Want zero setup? A managed cloud platform is in the works. Join the <a href="https://app.youform.com/forms/9hbdmkly" target="_blank" rel="noopener noreferrer">waitlist</a> or book a <a href="https://cal.com/ganesh-sivakumar/30min" target="_blank" rel="noopener noreferrer">quick call</a> to chat about custom templates executed on LangBeam cloud platform.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/Ganeshsivakumar/langchain-beam/tree/main/docs/docs-site/docs/docs/templates/llm-batch-process.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/langchain-beam/docs/category/templates/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Templates</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/langchain-beam/docs/category/integrations/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Integrations</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#what-it-does-️" class="table-of-contents__link toc-highlight">What It Does 🛠️</a></li><li><a href="#use-cases-" class="table-of-contents__link toc-highlight">Use Cases 📦</a></li><li><a href="#template-parameters-️" class="table-of-contents__link toc-highlight">Template Parameters ⚙️</a></li><li><a href="#how-to-run-" class="table-of-contents__link toc-highlight">How to Run 🚀</a><ul><li><a href="#1-google-cloud-dataflow" class="table-of-contents__link toc-highlight">1. Google Cloud Dataflow</a></li><li><a href="#2-apache-flink" class="table-of-contents__link toc-highlight">2. Apache Flink</a></li><li><a href="#3-locally" class="table-of-contents__link toc-highlight">3. Locally</a></li><li><a href="#4-apache-spark" class="table-of-contents__link toc-highlight">4. Apache Spark</a></li></ul></li><li><a href="#template-support-" class="table-of-contents__link toc-highlight">Template Support 🧰</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/langchain-beam/docs/intro/">Tutorial</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/Ganeshsivakumar/langchain-beam" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div></div></footer></div>
</body>
</html>